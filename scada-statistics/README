1.代码仓库地址：https://github.com/zyjcyg/scada
2.代码位置：scada-statistics/src/main/java/com/scada/project/statistics
3.任务位置：scada-statistics/src/main/java/com/scada/project/monitor/job/task
4.数据库脚本位置：scada-statistics/sql/scada-statistics.sql
5.任务查询sql脚本位置：scada-statistics/sql/status.sql
6.统计任务说明：
a.可利用率按天统计
(1).统计任务名称：avaiStatByDay
(2).sql语句
SELECT
a.turbine_id,
b.turbine_name,
a.total_time_length,
a.total_available_time_length,
b.line_id,
b.line_name,
b.wind_field_id,
b.wind_field_name
FROM
(
SELECT
t.turbine_id,
(MAX( t.total_time_length ) - MIN( t.total_time_length )) total_time_length,
(
(MAX( t.total_suspended_time_length ) - MIN( t.total_suspended_time_length )) * 1 +
(MAX( t.total_production_time_length ) - MIN( t.total_production_time_length )) * 1 +
(MAX( t.total_mannul_stop_time_length ) - MIN( t.total_mannul_stop_time_length )) * 1 +
(MAX( t.total_wether_stop_time_length ) - MIN( t.total_wether_stop_time_length )) * 1 +
(MAX( t.total_force_majeure_time_length ) - MIN( t.total_force_majeure_time_length )) * 1 +
(MAX( t.total_grid_fault_stop_time_length ) - MIN( t.total_grid_fault_stop_time_length )) * 1 +
(MAX( t.total_full_performance_time_length ) - MIN( t.total_full_performance_time_length )) * 1 +
(MAX( t.total_technical_standby_time_length ) - MIN( t.total_technical_standby_time_length )) * 1 +
(MAX( t.total_turbine_fault_stop_time_length ) - MIN( t.total_turbine_fault_stop_time_length )) * 1 +
(MAX( t.total_shceduled_maintenance_time_length ) - MIN( t.total_shceduled_maintenance_time_length )) * 1 +
(MAX( t.total_information_unavailable_time_length ) - MIN( t.total_information_unavailable_time_length )) * 1 +
(MAX( t.total_planned_corrective_action_time_length ) - MIN( t.total_planned_corrective_action_time_length )) * 1
) total_available_time_length
FROM
t_main_state_log t
WHERE
t.create_time BETWEEN DATE_ADD( DATE_SUB( CURDATE(), INTERVAL 1 DAY ), INTERVAL 0 HOUR ) AND DATE_ADD( CURDATE(), INTERVAL 10 SECOND )
GROUP BY
t.turbine_id
) AS a
LEFT JOIN t_turbine_info b ON a.turbine_id = b.turbine_id;
(3).任务说明
b.可利用率按月统计
(1).统计任务名称：avaiStatByMonth
(2).sql语句
SELECT
a.turbine_id,
b.turbine_name,
a.statistical_time_length,
a.availiable_time_length,
b.line_id,
b.line_name,
b.wind_field_id,
b.wind_field_name
FROM
(
SELECT
t.turbine_id,
SUM( t.statistical_time_length ) statistical_time_length,
SUM( t.availiable_time_length ) availiable_time_length
FROM
t_availability_day_statistics t
WHERE
MONTH ( t.statistical_time ) = MONTH (DATE_SUB( CURDATE(), INTERVAL 1 DAY )) AND YEAR ( t.statistical_time ) = YEAR (DATE_SUB( CURDATE(), INTERVAL 1 DAY ))
GROUP BY
t.turbine_id
) AS a
INNER JOIN t_availability_day_statistics b ON a.turbine_id = b.turbine_id;
(3).任务说明
c.可利用率按年统计
(1).统计任务名称：avaiStatByYear
(2).sql语句
SELECT
a.turbine_id,
b.turbine_name,
a.statistical_time_length,
a.availiable_time_length,
b.line_id,
b.line_name,
b.wind_field_id,
b.wind_field_name
FROM
(
SELECT
t.turbine_id,
SUM( t.statistical_time_length ) statistical_time_length,
SUM( t.availiable_time_length ) availiable_time_length
FROM
t_availability_month_statistics t
WHERE
YEAR ( t.statistical_time ) = YEAR (DATE_SUB( CURDATE(), INTERVAL 1 DAY ))
GROUP BY
t.turbine_id
) AS a
INNER JOIN t_availability_month_statistics b ON a.turbine_id = b.turbine_id;
(3).任务说明
d.停机按小时统计
(1).统计任务名称：shutdownStat
(2).sql语句
SELECT
a.turbine_id,
b.turbine_name,
a.stop_time,
a.stop_time_length,
a.stop_state_code,
a.stop_category,
b.line_id,
b.line_name,
b.wind_field_id,
b.wind_field_name
FROM
(
SELECT
t.`turbine_id`,
t.`availbility_status` AS stop_category,
t.`active_code` AS stop_state_code,
MIN( t.create_time ) AS stop_time,
(MAX( t.total_mannul_stop_time_length ) - MIN( t.total_mannul_stop_time_length ) +
MAX( t.total_wether_stop_time_length ) - MIN( t.total_wether_stop_time_length ) +
MAX( t.total_grid_fault_stop_time_length ) - MIN( t.total_grid_fault_stop_time_length ) +
MAX( t.total_turbine_fault_stop_time_length ) - MIN( t.total_turbine_fault_stop_time_length )
) stop_time_length
FROM
t_main_state_log t
WHERE
t.`availbility_status` != '运行'
AND t.`create_time` BETWEEN DATE_SUB( NOW(), INTERVAL 1 HOUR ) AND NOW()
GROUP BY
t.`turbine_id`,
t.`availbility_status`,
t.`active_code`
) AS a
LEFT JOIN t_turbine_info b ON a.turbine_id = b.turbine_id;
(3).任务说明
e.功率曲线按天统计
(1).统计任务名称：powerCurveStat
(2).sql语句
SELECT
a.turbine_id,
b.turbine_name,
a.count_num,
a.active_power_avg,
b.line_id,
b.line_name,
b.wind_field_id,
b.wind_field_name
FROM
(
SELECT
t.`turbine_id`,
COUNT(*) AS count_num,
t.`active_power_avg`
FROM
t_ten_minute_log t
WHERE
t.`status_bit_mask` = 12
AND t.`create_time` BETWEEN DATE_SUB( CURDATE(), INTERVAL 1 DAY )
AND CURDATE()
AND t.`stand_wind_spd` BETWEEN 0.25 AND 0.75
GROUP BY
t.`turbine_id`,
t.`active_power_avg`
) AS a
LEFT JOIN t_turbine_info b ON a.turbine_id = b.turbine_id;
(3).任务说明
f.风况按天统计（30秒粒度没有思路，10分钟粒度不用统计，直接查询十分钟日志应该就可以）
g.部件按天统计（未做）
